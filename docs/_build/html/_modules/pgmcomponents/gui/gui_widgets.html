<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pgmcomponents.gui.gui_widgets &#8212; pgmcomponents 0.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=039e1c02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=eafc0fe6" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=d7c963c3"></script>
    <script src="../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pgmcomponents.gui.gui_widgets</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">gui_widgets.py</span>

<span class="sd">Provides a set of widgets for use in the GUI.</span>

<span class="sd">Author: Patrick Wang</span>
<span class="sd">Email: patrick.wang@diamond.ac.uk</span>
<span class="sd">Date: 2023-10-05</span>
<span class="sd">Version = 0.4.1</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">PySimpleGUI</span> <span class="k">as</span> <span class="nn">sg</span>
<span class="kn">from</span> <span class="nn">pgmcomponents.geometry</span> <span class="kn">import</span> <span class="n">calc_beam_size</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pgmcomponents.gui.mplwidgets</span> <span class="kn">import</span> <span class="n">draw_figure_w_toolbar</span>
<span class="kn">from</span> <span class="nn">colorama</span> <span class="kn">import</span> <span class="n">Fore</span><span class="p">,</span> <span class="n">Back</span><span class="p">,</span> <span class="n">Style</span><span class="p">,</span> <span class="n">init</span>
<span class="kn">from</span> <span class="nn">pgmcomponents.elements</span> <span class="kn">import</span> <span class="o">*</span>

 

<div class="viewcode-block" id="EPICScontrol"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol">[docs]</a><span class="k">class</span> <span class="nc">EPICScontrol</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A EPICS like control widget.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the control.</span>
<span class="sd">    value : float</span>
<span class="sd">        The default value of the control</span>
<span class="sd">    increments: float</span>
<span class="sd">        The default increment value of the control.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key of the control.</span>
<span class="sd">    pgm : PGM</span>
<span class="sd">        The PGM object.</span>


<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    up(window)</span>
<span class="sd">        Add increment to value</span>
<span class="sd">    down(window)</span>
<span class="sd">        Subtract increment from value</span>
<span class="sd">    update(window)</span>
<span class="sd">        Update the displayed value of the control.</span>
<span class="sd">    write(window, value, pgm)</span>
<span class="sd">        Write a value to the control.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">increments</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pgm</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">increments</span> <span class="o">=</span> <span class="n">increments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">button_image</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x89</span><span class="s1">PNG</span><span class="se">\r\n\x1a\n\x00\x00\x00\r</span><span class="s1">IHDR</span><span class="se">\x00\x00\x00\x01\x00\x00\x00\x01\x08\x06\x00\x00\x00\x1f\x15\xc4\x89\x00\x00\x00\r</span><span class="s1">IDATx</span><span class="se">\x9c</span><span class="s1">c````</span><span class="se">\x00\x00\x00\x05\x00\x01\xa5\xf6</span><span class="s1">E@</span><span class="se">\x00\x00\x00\x00</span><span class="s1">IEND</span><span class="se">\xae</span><span class="s1">B`</span><span class="se">\x82</span><span class="s1">&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;-ENERGY-&#39;</span><span class="p">:</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;-CFF-&#39;</span><span class="p">:</span><span class="s1">&#39;cff&#39;</span><span class="p">,</span> <span class="s1">&#39;-ORDER-&#39;</span><span class="p">:</span><span class="s1">&#39;grating.order&#39;</span><span class="p">,</span> <span class="s1">&#39;-LINE_DENSITY-&#39;</span><span class="p">:</span><span class="s1">&#39;grating.line_density&#39;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">pgm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># avoid use of eval with user input (key)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pgm.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="p">[[</span><span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_text</span><span class="o">=</span><span class="s1">&#39;â€•&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_down&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span><span class="n">image_data</span><span class="o">=</span><span class="n">button_image</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">)),</span>
                   <span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">([[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span><span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)],</span>
                              <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span>
                              <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">default_text</span><span class="o">=</span><span class="n">increments</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">()]]),</span>
                              <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_text</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span><span class="n">image_data</span><span class="o">=</span><span class="n">button_image</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">auto_size_button</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_up&quot;</span><span class="p">)],</span>
                <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">expand_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expand_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># don&#39;t need return</span>
        <span class="k">return</span>

    <span class="c1"># PGM imported from * import. </span>
<div class="viewcode-block" id="EPICScontrol.up"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol.up">[docs]</a>    <span class="k">def</span> <span class="nf">up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : PySimpleGUI.Window</span>
<span class="sd">            The window object containing the control.</span>
<span class="sd">        values : dict</span>
<span class="sd">            The values of the window.</span>
<span class="sd">        pgm : PGM</span>
<span class="sd">            The PGM object.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Add increment to value, needs the window object to update the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;-ORDER-&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">updated</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]))</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]))</span>
                <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span>
                <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
                <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here!&#39;</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">updated</span><span class="p">)</span>

            <span class="c1"># make exception more specific</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Order should be type int&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">updated</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]),</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span>
            <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
            <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">updated</span><span class="p">)</span>
            
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="EPICScontrol.down"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol.down">[docs]</a>    <span class="k">def</span> <span class="nf">down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Subtract the increment value from the current value of the widget.</span>
<span class="sd">            If the widget is an order widget, the current value is converted to an integer before subtraction.</span>
<span class="sd">            The updated value is then set as the new value of the widget and also updated in the corresponding attribute of the pgm object.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            window : PySimpleGUI.Window</span>
<span class="sd">                The window object containing the control.</span>
<span class="sd">            values : dict</span>
<span class="sd">                The values of the window.</span>
<span class="sd">            pgm : PGM20</span>
<span class="sd">                The PGM object.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;-ORDER-&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">updated</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
                    <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span>
                    <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
                    <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="n">updated</span><span class="p">)</span>

                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Order should be type int&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;-CFF-&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1st loop&#39;</span><span class="p">)</span>
                <span class="n">test_update</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">test_update</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Is condition triggered?&quot;</span><span class="p">)</span>
                    <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Cff cannot be less than 1&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">updated</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span>
                    <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
                    <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">updated</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>
                <span class="n">updated</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()),</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated</span>
                <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">updated</span><span class="p">)</span>
                <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="n">updated</span><span class="p">)</span>
            <span class="k">return</span></div>
    
<div class="viewcode-block" id="EPICScontrol.update"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Update the value of the control.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            window: The window object containing the control.</span>
<span class="sd">            pgm: The program object containing the property to be updated.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>

<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;-ORDER-&quot;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            <span class="k">return</span></div>
    
    <span class="c1"># pgm parameter not used</span>
<div class="viewcode-block" id="EPICScontrol.write"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Subroutine to write the values of a known pgm to</span>
<span class="sd">        the window.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : PySimpleGUI.Window</span>
<span class="sd">            The main window.</span>
<span class="sd">        value : float</span>
<span class="sd">            The value to write to the control.</span>
<span class="sd">        pgm : PGM</span>
<span class="sd">            The PGM object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span>
    
        <span class="k">return</span></div>

<div class="viewcode-block" id="EPICScontrol.update_inc"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.EPICScontrol.update_inc">[docs]</a>    <span class="k">def</span> <span class="nf">update_inc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the increment of the control.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : PySimpleGUI.Window</span>
<span class="sd">            The window object containing the control.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">_inc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">increments</span><span class="p">)</span>
        <span class="k">return</span></div></div>
    
    

<span class="c1"># Plane_Mirror and Grating undefined here</span>
<div class="viewcode-block" id="configuration_popup"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.configuration_popup">[docs]</a><span class="k">def</span> <span class="nf">configuration_popup</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">element</span><span class="p">:</span> <span class="n">Plane_Mirror</span> <span class="o">|</span> <span class="n">Grating</span><span class="p">,</span> <span class="n">window</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a popup window for configuration of Plane_Mirror or Grating.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    title : str</span>
<span class="sd">        The title of the popup window.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key of the element.</span>
<span class="sd">    element : Plane_Mirror or Grating</span>
<span class="sd">        The element to configure. Either &#39;Plane_Mirror&#39; or &#39;Grating&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    values : dict</span>
<span class="sd">        A dictionary of values for the element.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">dimensions</span>
    <span class="n">sagittal_borders</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">borders</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tangential_borders</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">borders</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="p">[[</span>
    <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">([[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">)],</span> 
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Width&#39;</span><span class="p">)],</span> 
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Height&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span> 
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Sagittal Borders&#39;</span><span class="p">)],</span> 
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Tangential Borders&#39;</span><span class="p">)]]),</span>

    <span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">([[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_length&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">default_text</span><span class="o">=</span><span class="n">length</span><span class="p">)],</span> 
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_width&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">width</span><span class="p">)],</span> 
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_height&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">height</span><span class="p">)],</span>
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span> 
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_sagittal_borders&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">sagittal_borders</span><span class="p">)],</span> 
               <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_tangential_borders&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">tangential_borders</span><span class="p">)]])],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">)]</span>
                <span class="p">]]</span>

    <span class="n">configwindow</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">configwindow</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">sg</span><span class="o">.</span><span class="n">WIN_CLOSED</span> <span class="ow">or</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">:</span>
            <span class="n">configwindow</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Save&#39;</span><span class="p">:</span>
            <span class="n">configwindow</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_length&#39;</span><span class="p">]),</span> 
                                               <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_width&#39;</span><span class="p">]),</span> 
                                               <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_height&#39;</span><span class="p">])])</span>
            <span class="c1"># catch more specific exception</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid dimensions&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">element</span><span class="o">.</span><span class="n">borders</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_sagittal_borders&#39;</span><span class="p">]),</span> 
                                            <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_sagittal_borders&#39;</span><span class="p">]),</span> 
                                            <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_tangential_borders&#39;</span><span class="p">]),</span> 
                                            <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_tangential_borders&#39;</span><span class="p">])])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid borders&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="n">e</span><span class="p">],[</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()]])</span>
                <span class="k">continue</span>
            <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">break</span>
            
    <span class="k">return</span> <span class="n">values</span> <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Save&#39;</span> <span class="k">else</span> <span class="kc">None</span></div>

<span class="c1"># don&#39;t need to inherit from object. Rename BeamConfig for PascalCase</span>
<div class="viewcode-block" id="Beam_Config"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Beam_Config">[docs]</a><span class="k">class</span> <span class="nc">Beam_Config</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides a class for beam configuration.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    electron_size_h : float</span>
<span class="sd">        The electron horizontal size RMS.</span>
<span class="sd">    electron_size_v : float</span>
<span class="sd">        The electron vertical size RMS.</span>
<span class="sd">    electron_div_h : float</span>
<span class="sd">        The electron horizontal divergence RMS.</span>
<span class="sd">    electron_div_v : float</span>
<span class="sd">        The electron vertical divergence RMS.</span>
<span class="sd">    id_length : float</span>
<span class="sd">        The length of the insertion device.</span>
<span class="sd">    distance : float</span>
<span class="sd">        The distance from the insertion device to the image plane.</span>
<span class="sd">    num_of_sigmas : float</span>
<span class="sd">        The number of sigmas to include in the beam size calculation.</span>
<span class="sd">    beam_size_h : float</span>
<span class="sd">        The horizontal beam size.</span>
<span class="sd">    beam_size_v : float</span>
<span class="sd">        The vertical beam size.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    window(window, pgm)</span>
<span class="sd">        Pops up a window for beam configuration.</span>

<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_length</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># don&#39;t need return</span>
        <span class="k">return</span>


    
    <span class="c1"># This function is very long. Can you refactor into smaller functions.</span>
<div class="viewcode-block" id="Beam_Config.window"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Beam_Config.window">[docs]</a>    <span class="k">def</span> <span class="nf">window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pops up a window for beam configuration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        window : PySimpleGUI.Window</span>
<span class="sd">            The main window.</span>
<span class="sd">        pgm : PGM</span>
<span class="sd">            The PGM object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">layout</span> <span class="o">=</span> <span class="p">[[</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">([</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s1">&#39;Calculate for ID beamline&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;calculate_q&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Electron Horizontal Size RMS (Î¼m)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Electron Vertical Size RMS (Î¼m)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Electron Divergence Horizontal RMS (Î¼rad)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Electron Divergence Vertical RMS (Î¼rad)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;ID Length (m)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Distance from ID (m)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Number of sigma to include&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Beam Horizontal Size (mm)&#39;</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Beam Vertical Size (mm)&#39;</span><span class="p">)],</span>
            <span class="p">]),</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">Column</span><span class="p">([</span>
                <span class="p">[],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;id_length&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
            <span class="p">],</span> <span class="n">pad</span><span class="o">=</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">30</span><span class="p">,</span><span class="mi">0</span><span class="p">)))],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Save &amp; Exit&#39;</span><span class="p">)</span> <span class="p">]</span>
        <span class="p">]]</span>

        <span class="n">config_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_size_v&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_v&#39;</span><span class="p">,</span> <span class="s1">&#39;id_length&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]</span>

        <span class="c1"># use def instead of lambda here</span>
        <span class="n">check_fill</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">all</span><span class="p">([</span><span class="n">window_beam</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">])</span>
        <span class="n">window_beam</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;Beam Configuration&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">modal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">finalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_length</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">pgm</span><span class="o">.</span><span class="n">beam_width</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span> <span class="ow">and</span> <span class="n">pgm</span><span class="o">.</span><span class="n">beam_height</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span><span class="p">:</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Beam size does not match calculated beam size.&#39;</span><span class="p">)</span>
            <span class="c1"># Can you give a more specific exception and useful error msg here</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid values&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_length</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">distance</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;calculate_q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config_keys</span><span class="p">:</span>
                <span class="n">window_beam</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">beam_width</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">beam_height</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            
           

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window_beam</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">sg</span><span class="o">.</span><span class="n">WIN_CLOSED</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;calculate_q&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;calculate_q&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_size_v&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_v&#39;</span><span class="p">,</span> <span class="s1">&#39;id_length&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]:</span>
                        <span class="n">window_beam</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_size_v&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_h&#39;</span><span class="p">,</span> <span class="s1">&#39;electron_div_v&#39;</span><span class="p">,</span> <span class="s1">&#39;id_length&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]:</span>
                        <span class="n">window_beam</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Save &amp; Exit&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;calculate_q&#39;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">beam_size_h</span> <span class="o">=</span> <span class="n">calc_beam_size</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]),</span>
                                                     <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]),</span>
                                                     <span class="n">pgm</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
                                                     <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]),</span>
                                                     <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]),</span>
                                                     <span class="n">num_of_sigmas</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]))</span>
                        <span class="n">beam_size_v</span> <span class="o">=</span> <span class="n">calc_beam_size</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]),</span>
                                                    <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]),</span>
                                                    <span class="n">pgm</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span>
                                                    <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]),</span>
                                                    <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]),</span>
                                                    <span class="n">num_of_sigmas</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span> <span class="o">=</span> <span class="n">beam_size_h</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span> <span class="o">=</span> <span class="n">beam_size_v</span>
                        <span class="n">pgm</span><span class="o">.</span><span class="n">beam_width</span> <span class="o">=</span> <span class="n">beam_size_h</span>
                        <span class="n">pgm</span><span class="o">.</span><span class="n">beam_height</span> <span class="o">=</span> <span class="n">beam_size_v</span>
                        <span class="n">window_beam</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="s1">&#39;beam&#39;</span><span class="p">)</span>
                        <span class="k">break</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid values&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="n">e</span><span class="p">],[</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()]])</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">pgm</span><span class="o">.</span><span class="n">beam_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="n">pgm</span><span class="o">.</span><span class="n">beam_height</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">id_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span> <span class="k">if</span> <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="k">else</span> <span class="kc">None</span>


                        <span class="n">window_beam</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="n">window</span><span class="o">.</span><span class="n">write_event_value</span><span class="p">(</span><span class="s1">&#39;Update&#39;</span><span class="p">,</span> <span class="s1">&#39;beam&#39;</span><span class="p">)</span>
                        <span class="k">break</span>

                        
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">sg</span><span class="o">.</span><span class="n">PopupOKCancel</span><span class="p">(</span><span class="s2">&quot;Can&#39;t convert certain values to float. Discarding problematic values. Continue?&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_h</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">electron_size_v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_h</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">electron_div_v</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">id_length</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_of_sigmas</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                            <span class="n">window_beam</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                            <span class="k">break</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">continue</span>

                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid values&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="n">e</span><span class="p">],[</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()]])</span>
                        <span class="k">continue</span>




            <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">:</span>
                <span class="n">window_beam</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">check_fill</span><span class="p">()</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;calculate_q&#39;</span><span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>

                    <span class="n">beam_size_h</span> <span class="o">=</span> <span class="n">calc_beam_size</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_h&#39;</span><span class="p">]),</span> 
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_h&#39;</span><span class="p">]),</span> 
                                                <span class="n">pgm</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> 
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]),</span>
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]),</span> 
                                                <span class="n">num_of_sigmas</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]))</span>
                    
                    
                    <span class="n">beam_size_v</span> <span class="o">=</span> <span class="n">calc_beam_size</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_size_v&#39;</span><span class="p">]),</span>
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;electron_div_v&#39;</span><span class="p">]),</span> 
                                                <span class="n">pgm</span><span class="o">.</span><span class="n">wavelength</span><span class="p">,</span> 
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]),</span>
                                                <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;id_length&#39;</span><span class="p">]),</span> 
                                                <span class="n">num_of_sigmas</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;num_of_sigmas&#39;</span><span class="p">]))</span>
                    
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_h&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">beam_size_h</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
                    <span class="n">window_beam</span><span class="p">[</span><span class="s1">&#39;beam_size_v&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">beam_size_v</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_h</span> <span class="o">=</span> <span class="n">beam_size_h</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">beam_size_v</span> <span class="o">=</span> <span class="n">beam_size_v</span>
                    <span class="n">pgm</span><span class="o">.</span><span class="n">beam_height</span> <span class="o">=</span> <span class="n">beam_size_v</span>
                    <span class="n">pgm</span><span class="o">.</span><span class="n">beam_width</span> <span class="o">=</span> <span class="n">beam_size_h</span>
                    <span class="c1"># don&#39;t need pass</span>
                    <span class="k">pass</span>
                    
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Invalid values&#39;</span><span class="p">,</span> <span class="p">[[</span><span class="n">e</span><span class="p">],[</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()]])</span>
                    <span class="c1"># dont&#39; need pass</span>
                    <span class="k">pass</span>

            
            
        <span class="c1"># don&#39;t need return</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="OffsetsControl"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.OffsetsControl">[docs]</a><span class="k">class</span> <span class="nc">OffsetsControl</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to provide the offsets control widget.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    values : dict</span>
<span class="sd">        The default values of the control.</span>
<span class="sd">        keys: &#39;beam_vertical&#39;, &#39;mirror_hoffset&#39;, &#39;mirror_voffset&#39;, &#39;mirror_axis_hoffset&#39;, &#39;mirror_axis_voffset&#39;</span>
<span class="sd">    key : str</span>
<span class="sd">        The key of the control.</span>
<span class="sd">    </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    update(window, pgm, )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Beam Vertical Offset (b):&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_beam_vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;beam_vertical&#39;</span><span class="p">],</span> <span class="n">focus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span> <span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Mirror Horizontal Offset (a):&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_horizontal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_hoffset&#39;</span><span class="p">])],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">HorizontalSeparator</span><span class="p">()],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Checkbox</span><span class="p">(</span><span class="s1">&#39;Calculate Offsets?&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_calculate&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">enable_events</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Mirror Vertical Offset (c):&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_voffset&#39;</span><span class="p">]</span> <span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Mirror Axis Horizontal Offset (h):&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_horizontal&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_axis_hoffset&#39;</span><span class="p">],</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Mirror Axis Vertical Offset (v):&#39;</span><span class="p">),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Push</span><span class="p">(),</span> <span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_vertical&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">default_text</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_axis_voffset&#39;</span><span class="p">],</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
            <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Offsets&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">expand_x</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">expand_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate</span> <span class="o">=</span> <span class="kc">True</span>
    
<div class="viewcode-block" id="OffsetsControl.updatepgm"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.OffsetsControl.updatepgm">[docs]</a>    <span class="k">def</span> <span class="nf">updatepgm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the values of the PGM object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">beam_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_beam_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">hoffset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_horizontal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">voffset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">axis_hoffset</span> <span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_horizontal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">axis_voffset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="k">return</span></div>
    
<div class="viewcode-block" id="OffsetsControl.calcoffsets"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.OffsetsControl.calcoffsets">[docs]</a>    <span class="k">def</span> <span class="nf">calcoffsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the offsets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># mirror_voffset and mirror_axis_voffset should be in __init__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror_voffset</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_beam_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mirror_axis_voffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirror_voffset</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">voffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirror_voffset</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">axis_voffset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mirror_axis_voffset</span>
        <span class="n">window</span><span class="p">[</span><span class="s1">&#39;-OFFSETS-_mirror_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_voffset</span><span class="p">)</span>
        <span class="n">window</span><span class="p">[</span><span class="s1">&#39;-OFFSETS-_mirror_axis_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mirror_axis_voffset</span><span class="p">)</span></div>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate</span>
    
    <span class="nd">@calculate</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calculate</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span>
    
<div class="viewcode-block" id="OffsetsControl.write"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.OffsetsControl.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">calcq</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write values to the control.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_beam_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;beam_vertical&#39;</span><span class="p">])</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_horizontal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_hoffset&#39;</span><span class="p">])</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_voffset&#39;</span><span class="p">])</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_horizontal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_axis_hoffset&#39;</span><span class="p">])</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_mirror_axis_vertical&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;mirror_axis_voffset&#39;</span><span class="p">])</span>
        <span class="n">window</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_calculate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">calcq</span><span class="p">)</span>

        <span class="k">return</span></div></div>

<span class="c1"># rename TopViewWidget</span>
<div class="viewcode-block" id="Topview_Widget"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Topview_Widget">[docs]</a><span class="k">class</span> <span class="nc">Topview_Widget</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to supply the GUI widget for a top-view</span>
<span class="sd">    footprint plot of a given PGM.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;-TOPVIEW-&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">)):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span> <span class="o">=</span> <span class="n">pgm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pgm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span>
    
    <span class="nd">@pgm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pgm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span>
    
    <span class="nd">@key</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
    
    <span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Footprint View&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">]],</span> <span class="n">element_justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    

<div class="viewcode-block" id="Topview_Widget.make_canvas"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Topview_Widget.make_canvas">[docs]</a>    <span class="k">def</span> <span class="nf">make_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">canvas_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> 
                               <span class="n">graph_bottom_left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror_corners</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> 
                               <span class="n">graph_top_right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror_corners</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> 
                               <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> 
                               <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                               <span class="n">right_click_menu</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">],[</span><span class="s1">&#39;Reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Save As...&#39;</span><span class="p">]])</span></div>
    
<div class="viewcode-block" id="Topview_Widget.draw"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Topview_Widget.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="k">pass</span></div></div>

<div class="viewcode-block" id="Sideview_Widget"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Sideview_Widget">[docs]</a><span class="k">class</span> <span class="nc">Sideview_Widget</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;-SIDEVIEW-&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span> <span class="o">=</span> <span class="n">pgm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pgm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span>
    
    <span class="nd">@pgm</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">pgm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pgm</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span>
    
    <span class="nd">@key</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
    
    <span class="nd">@size</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_canvas</span><span class="p">()</span>
        <span class="k">return</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Side View&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">control_canvas</span><span class="p">]],</span> <span class="n">element_justification</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    

<div class="viewcode-block" id="Sideview_Widget.make_canvas"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Sideview_Widget.make_canvas">[docs]</a>    <span class="k">def</span> <span class="nf">make_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">right_click_menu</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">],[</span><span class="s1">&#39;Reset&#39;</span><span class="p">,</span> <span class="s1">&#39;Save As...&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">control_canvas</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s1">_control&#39;</span><span class="p">)</span></div>
    

    

<div class="viewcode-block" id="Sideview_Widget.draw"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.Sideview_Widget.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="k">pass</span></div></div>
        
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">beam</span> <span class="o">=</span> <span class="n">Beam_Config</span><span class="p">()</span>
    <span class="n">mirror</span> <span class="o">=</span> <span class="n">Plane_Mirror</span><span class="o">.</span><span class="n">mirror_from_file</span><span class="p">(</span><span class="s1">&#39;config_pgm.ini&#39;</span><span class="p">)</span>
    <span class="n">grating</span> <span class="o">=</span> <span class="n">Grating</span><span class="o">.</span><span class="n">grating_from_file</span><span class="p">(</span><span class="s1">&#39;config_pgm.ini&#39;</span><span class="p">)</span>
    <span class="n">pgm</span><span class="o">=</span><span class="n">PGM</span><span class="p">(</span><span class="n">mirror</span><span class="o">=</span><span class="n">mirror</span><span class="p">,</span> <span class="n">grating</span><span class="o">=</span><span class="n">grating</span><span class="p">)</span>
    <span class="n">offsetscontrol</span> <span class="o">=</span> <span class="n">OffsetsControl</span><span class="p">(</span><span class="n">pgm</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="s1">&#39;offsets_test&#39;</span><span class="p">)</span>
    <span class="n">test</span> <span class="o">=</span> <span class="n">EPICScontrol</span><span class="p">(</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
    <span class="n">window</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">(</span><span class="s1">&#39;EPICS Control&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">[[</span><span class="n">test</span><span class="o">.</span><span class="n">frame</span><span class="p">],</span> 
                                                <span class="p">[</span><span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">),</span> 
                                                 <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Cancel&#39;</span><span class="p">),</span>
                                                 <span class="n">sg</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="s1">&#39;Beam Config&#39;</span><span class="p">)],</span>
                                                 <span class="p">[</span><span class="n">offsetscontrol</span><span class="o">.</span><span class="n">frame</span><span class="p">]</span>
                                                 <span class="p">])</span>
    
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># values not used</span>
        <span class="n">event</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="n">sg</span><span class="o">.</span><span class="n">WIN_CLOSED</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;OK&#39;</span><span class="p">:</span>
            <span class="n">configuration_popup</span><span class="p">(</span><span class="s1">&#39;Mirror Configuration&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">mirror</span><span class="p">)</span>
            
        
        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;test_up&#39;</span><span class="p">:</span>
            <span class="n">test</span><span class="o">.</span><span class="n">up</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;test_down&#39;</span><span class="p">:</span>
            <span class="n">test</span><span class="o">.</span><span class="n">down</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Cancel&#39;</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">elif</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;Beam Config&#39;</span><span class="p">:</span>
            <span class="n">beam</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">pgm</span><span class="p">)</span></div>
        

<div class="viewcode-block" id="update_and_draw"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.update_and_draw">[docs]</a><span class="k">def</span> <span class="nf">update_and_draw</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> 
                    <span class="n">pgm</span><span class="p">,</span> 
                    <span class="n">values</span><span class="p">,</span> 
                    <span class="n">topview_widget</span><span class="p">,</span> 
                    <span class="n">sideview_widget</span><span class="p">,</span> 
                    <span class="n">energy_control</span><span class="p">,</span> 
                    <span class="n">cff_control</span><span class="p">,</span> 
                    <span class="n">order_control</span><span class="p">,</span> 
                    <span class="n">line_density_control</span><span class="p">,</span>
                    <span class="n">offsets_control</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the values of the PGM object and draw the</span>
<span class="sd">    topview and sideview widgets.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : PySimpleGUI.Window</span>
<span class="sd">        The main window.</span>
<span class="sd">    pgm : PGM</span>
<span class="sd">        The PGM object.</span>
<span class="sd">    values : dict</span>
<span class="sd">        The values of the controls.</span>
<span class="sd">    topview_widget : Topview_Widget</span>
<span class="sd">        The topview widget.</span>
<span class="sd">    sideview_widget : Sideview_Widget</span>
<span class="sd">        The sideview widget.</span>
<span class="sd">    energy_control : EPICScontrol</span>
<span class="sd">        The energy control.</span>
<span class="sd">    cff_control : EPICScontrol</span>
<span class="sd">        The cff control.</span>
<span class="sd">    order_control : EPICScontrol</span>
<span class="sd">        The order control.</span>
<span class="sd">    line_density_control : EPICScontrol</span>
<span class="sd">        The line density control.</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">energy_input</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ENERGY-&#39;</span><span class="p">])</span>
    <span class="n">cff_input</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-CFF-&#39;</span><span class="p">])</span>
    <span class="n">order_input</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ORDER-&#39;</span><span class="p">])</span>
    <span class="n">line_density_input</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-LINE_DENSITY-&#39;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">energy_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">energy_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">energy_input</span><span class="p">),</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="c1"># can remove all of these pass statements</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy must be a positive number&#39;</span><span class="p">)</span>
            <span class="n">energy_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy must be a positive number&#39;</span><span class="p">)</span>
        <span class="n">energy_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cff_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cff_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">cff_input</span><span class="p">),</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;CFF must be a positive number&#39;</span><span class="p">)</span>
            <span class="n">cff_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;CFF must be a positive number&#39;</span><span class="p">)</span>
        <span class="n">cff_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">order_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">order_input</span><span class="p">),</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Order must be a positive integer&#39;</span><span class="p">)</span>
            <span class="n">order_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Order must be a positive integer&#39;</span><span class="p">)</span>
        <span class="n">order_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
        <span class="k">pass</span>

    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_density_input</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">line_density_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">line_density_input</span><span class="p">),</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Line density must be a positive number&#39;</span><span class="p">)</span>
            <span class="n">line_density_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Line density must be a positive number&#39;</span><span class="p">)</span>
        <span class="n">line_density_control</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
        <span class="k">pass</span>

    <span class="n">pgm</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ENERGY-&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ENERGY-&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">cff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-CFF-&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-CFF-&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ORDER-&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-ORDER-&#39;</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">line_density</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-LINE_DENSITY-&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;-LINE_DENSITY-&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
    
    <span class="n">offsets_control</span><span class="o">.</span><span class="n">updatepgm</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;-OFFSETS-_calculate&#39;</span><span class="p">]:</span>
        <span class="n">offsets_control</span><span class="o">.</span><span class="n">calcoffsets</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">offsets_control</span><span class="o">.</span><span class="n">updatepgm</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># can just call functions without assigning to variables</span>
        <span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">compute_angles</span><span class="p">()</span>
        <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>
        <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>
        <span class="n">pgm</span><span class="o">.</span><span class="n">set_theta</span><span class="p">()</span>
        <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">sg</span><span class="o">.</span><span class="n">Popup</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span>
        
    <span class="n">topview_widget</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">sideview_widget</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="initial_draw"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.initial_draw">[docs]</a><span class="k">def</span> <span class="nf">initial_draw</span><span class="p">(</span><span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">,</span> 
                 <span class="n">pgm</span><span class="p">:</span><span class="n">PGM</span><span class="p">,</span> 
                 <span class="n">topview_widget</span><span class="p">:</span><span class="n">Topview_Widget</span><span class="p">,</span> 
                 <span class="n">sideview_widget</span><span class="p">:</span><span class="n">Sideview_Widget</span><span class="p">,</span> 
                 <span class="n">offsets_control</span><span class="p">:</span><span class="n">OffsetsControl</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Draw the topview and sideview widgets.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    window : PySimpleGUI.Window</span>
<span class="sd">        The main window.</span>
<span class="sd">    pgm : PGM</span>
<span class="sd">        The PGM object.</span>
<span class="sd">    topview_widget : Topview_Widget</span>
<span class="sd">        The topview widget.</span>
<span class="sd">    sideview_widget : Sideview_Widget</span>
<span class="sd">        The sideview widget.</span>
<span class="sd">    offsets_control : OffsetsControl</span>
<span class="sd">        The offsets control widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">generate_rays</span><span class="p">()</span>
    <span class="n">offsets_control</span><span class="o">.</span><span class="n">calcoffsets</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
    <span class="n">offsets_control</span><span class="o">.</span><span class="n">updatepgm</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">pgm</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">compute_angles</span><span class="p">()</span>
    <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>
    <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>
    <span class="n">pgm</span><span class="o">.</span><span class="n">set_theta</span><span class="p">()</span>
    <span class="n">_</span><span class="o">=</span><span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">compute_corners</span><span class="p">()</span>

    <span class="n">topview_widget</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">sideview_widget</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="k">return</span></div>

<div class="viewcode-block" id="maketable"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.maketable">[docs]</a><span class="k">def</span> <span class="nf">maketable</span><span class="p">(</span><span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">sg</span><span class="o">.</span><span class="n">Table</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a PySimpleGUI table for the PGM parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pgm : PGM</span>
<span class="sd">        The PGM object.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    table : PySimpleGUI.Table</span>
<span class="sd">        The table.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Parameter&quot;</span><span class="p">,</span> <span class="s2">&quot;Value&quot;</span><span class="p">)</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Order&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;LD (l/mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Energy (eV)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Cff&quot;</span><span class="p">,</span>
                <span class="s2">&quot;b (mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;a (mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;c (mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;h (mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;v (mm)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;alpha (deg)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;beta(deg)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;theta (deg)&quot;</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">order</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">line_density</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">cff</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">beam_offset</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">hoffset</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">voffset</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">axis_hoffset</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">axis_voffset</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">alpha</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">grating</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
              <span class="n">pgm</span><span class="o">.</span><span class="n">mirror</span><span class="o">.</span><span class="n">theta</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">param</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ndigits</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span> <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">values</span><span class="p">)]</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headings</span><span class="o">=</span><span class="n">columns</span><span class="p">,</span> <span class="n">auto_size_columns</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">justification</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">num_rows</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;-TABLE-&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">table</span></div>


<span class="k">class</span> <span class="nc">ParamTable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to provide a table of PGM parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgm</span> <span class="o">=</span> <span class="n">pgm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">maketable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;PGM Parameters&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">]])</span>
    
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">maketable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="p">)</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span>
        <span class="k">return</span>

<div class="viewcode-block" id="ParamTable"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.ParamTable">[docs]</a><span class="k">class</span> <span class="nc">ParamTable</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to provide a table of PGM parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgm</span> <span class="o">=</span> <span class="n">pgm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span> <span class="o">=</span> <span class="n">maketable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;PGM Parameters&#39;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="p">]])</span>
    
<div class="viewcode-block" id="ParamTable.update"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.ParamTable.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">:</span> <span class="n">sg</span><span class="o">.</span><span class="n">Window</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Update the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">maketable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pgm</span><span class="p">)</span><span class="o">.</span><span class="n">Values</span><span class="p">)</span>
        <span class="k">return</span></div></div>


<div class="viewcode-block" id="ZoomWidget"><a class="viewcode-back" href="../../../pgmcomponents.gui.html#pgmcomponents.gui.gui_widgets.ZoomWidget">[docs]</a><span class="k">class</span> <span class="nc">ZoomWidget</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to provide a widget to configure</span>
<span class="sd">    plotting ranges.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pgm</span><span class="p">:</span> <span class="n">PGM</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgm</span> <span class="o">=</span> <span class="n">pgm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">[[</span><span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;z min&quot;</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;-ZMIN-&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span>
                  <span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;z max&quot;</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;-ZMAX-&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span>
                  <span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;x min&quot;</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;-XMIN-&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">)),</span>
                  <span class="n">sg</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;x max&quot;</span><span class="p">),</span><span class="n">sg</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;-XMAX-&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">sg</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zoom&#39;</span><span class="p">,</span> <span class="n">expand_x</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
    


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">pgmcomponents</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pgmcomponents.elements.html">pgmcomponents.elements package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pgmcomponents.geometry.html">pgmcomponents.geometry package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pgmcomponents.gui.html">pgmcomponents.gui package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pgmcomponents.html">pgmcomponents package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../example.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledgements.html">acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Patrick Wang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>